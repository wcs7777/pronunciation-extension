import { waitRateLimit } from "../utils/pronunciation-source.js";

export default class IpaSource {

	/**
	 * @param {PronunciationSourceOptions} options
	 */
	constructor(options) {
		this.options = options;
	}

	/**
	 * @param {string} input
	 * @param {boolean} toText
	 * @param {?PronunciationSourceLastError} lastError
	 * @returns {boolean}
	 */
	enabled(input, toText, lastError) {
		let enabled = false;
		if (!toText) {
			enabled = this.options.enabled;
		} else {
			enabled = (
				this.options.enabledToText &&
				input.length <= this.options.textMaxLength
			);
		}
		const shouldWait = waitRateLimit(
			lastError,
			this.options.waitRateLimitTimeout,
			this.options.okStatus,
		);
		return enabled && !shouldWait;
	}

	/**
	 * @param {boolean} toText
	 * @returns {number}
	 */
	order(toText) {
		return !toText ? this.options.order : this.options.orderToText;
	}

	/**
	 * @returns {boolean}
	 */
	get save() {
		return this.options.save;
	}

	/**
	 * @returns {boolean}
	 */
	get saveError() {
		return this.options.saveError;
	}

}
